@page "/"

<PageTitle>Home Page</PageTitle>

<h1>Hello!</h1>

Welcome to your new app.

Below is the tree option for this homepage also doubling as the badge + activity tracker.

<a href="/UserManagement">Link to Another Page</a>


@*
<div>
    <TreeSelect TItem="string"
                Style="width:100%;"
                @bind-Value="value"
                Placeholder="Please select"
                AllowClear
                TreeDefaultExpandAll>
        <TreeNode TItem="string" Key="parent 1" Title="parent 1">
            <TreeNode TItem="string" Key="parent 1-0" Title="parent 1-0">
                <TreeNode TItem="string" Key="leaf1" Title="leaf1" />
                <TreeNode TItem="string" Key="leaf2" Title="leaf2" />
            </TreeNode>
            <TreeNode TItem="string" Key="parent 1-1" Title="parent 1-1">
                <TreeNode TItem="string" Key="leaf3">
                    <TitleTemplate>
                        <b Style="color:#08c;">leaf3</b>
                    </TitleTemplate>
                </TreeNode>
            </TreeNode>
        </TreeNode>
    </TreeSelect>
</div>

<Table DataSource="listOfData" TItem="ItemData" RowClassName="@(_=>"editable-row")" Bordered TableLayout="fixed">
    <ChildContent Context="data">
        <Column TData="string" Title="Name">
            @if (!editCache[data.Id].edit)
            {
                @data.Name
            }
            else
            {
                <Input @bind-Value="editCache[data.Id].data.Name" />
            }
        </Column>
        <Column TData="string" Title="Age">
            @if (!editCache[data.Id].edit)
            {
                @data.Age
            }
            else
            {
                <Input @bind-Value="editCache[data.Id].data.Age" />
            }
        </Column>
        <Column TData="string" Title="Address">
            @if (!editCache[data.Id].edit)
            {
                @data.Address
            }
            else
            {
                <Input @bind-Value="editCache[data.Id].data.Address" />
            }
        </Column>
        <ActionColumn Title="Action">
            @if (!editCache[data.Id].edit)
            {
                <a @onclick="() => startEdit(data.Id)">Edit</a>
            }
            else
            {
                <a @onclick="() => saveEdit(data.Id)" class="save">Save</a>
                <Popconfirm Title="Sure to cancel?"
                            OnConfirm="() => cancelEdit(data.Id)"
                            OkText="Yes"
                            CancelText="No">
                    <a>Cancel</a>
                </Popconfirm>
            }
        </ActionColumn>
    </ChildContent>
</Table>

<style>
    .save {
        margin-right: 8px;
    }
</style>

@code{

    record ItemData
    {
        public string Id { get; set; }
        public string Name { get; set; }
        public int Age { get; set; }
        public string Address { get; set; }
    };

    IDictionary<string, (bool edit, ItemData data)> editCache = new Dictionary<string, (bool edit, ItemData data)>();
    List<ItemData> listOfData = new();

    int i = 0;
    string editId;

    void startEdit(string id)
    {
        var data = editCache[id];
        editCache[id] = (true, data.data with { }); // add a copy in cache
    }

    void cancelEdit(string id)
    {
        var data = listOfData.FirstOrDefault(item => item.Id == id);
        editCache[id] = (false, data); // recovery
    }

    void saveEdit(string id)
    {
        var index = listOfData.FindIndex(item => item.Id == id);
        listOfData[index] = editCache[id].data; // apply the copy to data source
        editCache[id] = (false, listOfData[index]); // don't affect rows in editing
    }

    protected override void OnInitialized()
    {
        listOfData = Enumerable.Range(0, 20).Select(i => new ItemData { Id = $"{i}", Name = $"Edrward {i}", Age = 32, Address = $"London Park no. {i}" }).ToList();
        listOfData.ForEach(item =>
        {
            editCache[item.Id] = (false, item);
        });
    }

    private string value = "leaf3";

}
*@
